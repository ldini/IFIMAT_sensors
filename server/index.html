<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IFIMAT Sensor</title>
    <!-- Solucionar icono title -->
    <link rel="shortcut icon" href="/images/logo.png" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.tailwindcss.com"></script>

</head>
<body class="bg-gray-200">
    <!-- <h1><img style = "width: 200px; height: 50px;" src = "/images/LogoIfimatBlancoWeb.png"></h1> -->
    
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-8">
                <h1>IFIMAT</h1>
            </div>
            <!-- Solucionar canvas voltaje -->
            <div class="col-md-4">
                <!-- <canvas id="myChart5" width="100" height="100"></canvas> -->
            </div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <canvas id="myChart1" width="400" height="400"></canvas>
            </div>
            <div class="col-md-6">
                <canvas id="myChart2" width="400" height="400"></canvas>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <canvas id="myChart3" width="400" height="400"></canvas>
            </div>
            <div class="col-md-6">
                <canvas id="myChart4" width="400" height="400"></canvas>
            </div>
        </div>
    </div>
        

  
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <script src="/socket.io/socket.io.js" charset="utf-8"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"></script>
    <script src="chartjs-plugin-zoom.min.js"></script>
    
    <script>    
        const socket = io();
        let counter = 0;
        socket.on('arduino:data', function(data){
            myChart1.data.labels = data.map(v => v.time);
            myChart2.data.labels = data.map(v => v.time);
            myChart3.data.labels = data.map(v => v.time);
            myChart4.data.labels = data.map(v => v.time);
            // myChart5.data.labels.push(counter);

            myChart1.data.datasets[0].data = data.map(v => v.sensor1);
            myChart2.data.datasets[0].data = data.map(v => v.sensor2);
            myChart3.data.datasets[0].data = data.map(v => v.sensor3);
            myChart4.data.datasets[0].data = data.map(v => v.sensor4);
            // myChart5.data.datasets.forEach(dataset => {
            //     dataset.data.push(dataSerial.value)
            // });

            counter++;
            myChart1.update();
            myChart2.update();
            myChart3.update();
            myChart4.update();
            // myChart5.update();
        })

        const ctx1 = document.getElementById('myChart1').getContext('2d');
        const myChart1 = new Chart(ctx1, {
            type: 'line',
            data: {
                labels: ['TIEMPO'],
                datasets: [{
                    label: "SENSOR 1",
                    backgroundColor: 'rgb(187, 79, 156 ,0.2)',
                    borderColor: 'rgb(187, 79, 156 ,0.9)',
                    fill:true,
                    data: []
                }]
            },
            options: {
                scales: {
                    y: {
                        max:50,
                        min:0,
                        beginAtZero: false,
                        position: 'right'
                    }
                },
                plugins: {
                    zoom: {
                        zoom: {
                        wheel: {
                            enabled: true,
                        },
                        pinch: {
                            enabled: true
                        },
                        mode: 'y',
                        }
                    }
                },         
                responsive: false
            }
                
        });


        const ctx2 = document.getElementById('myChart2').getContext('2d');
        const myChart2 = new Chart(ctx2, {
            type: 'line',
            data: {
                labels: ['TIEMPO'],
                datasets: [{
                    label: "SENSOR 2",
                    backgroundColor: 'rgb(79, 87, 187  ,0.2)',
                    borderColor: 'rgb(79, 87, 187  ,0.9)',
                    fill:true,
                    data: []
                }]
            },
            options: {
                scales: {
                    y: {
                        max:50,
                        min:0,
                        beginAtZero: false,
                        position: 'right'
                    }
                },
                plugins: {
                    zoom: {
                        zoom: {
                        wheel: {
                            enabled: true,
                        },
                        pinch: {
                            enabled: true
                        },
                        mode: 'y',
                        }
                    }
                },         
                responsive: false
            }
        });

        const ctx3 = document.getElementById('myChart3').getContext('2d');
        const myChart3 = new Chart(ctx3, {
            type: 'line',
            data: {
                labels: ['TIEMPO'],
                datasets: [{
                    label: "SENSOR 3",
                    backgroundColor: 'rgb(79, 187, 182  ,0.2)',
                    borderColor: 'rgb(79, 187, 182  ,0.9)',
                    fill:true,
                    data: []
                }]
            },
            options: {
                scales: {
                    y: {
                        max:50,
                        min:0,
                        beginAtZero: false,
                        position: 'right'
                    }
                },
                plugins: {
                    zoom: {
                        zoom: {
                        wheel: {
                            enabled: true,
                        },
                        pinch: {
                            enabled: true
                        },
                        mode: 'y',
                        }
                    }
                },         
                responsive: false
            }
        });

        const ctx4 = document.getElementById('myChart4').getContext('2d');
        const myChart4 = new Chart(ctx4, {
            type: 'line',
            data: {
                labels: ['TIEMPO'],
                datasets: [{
                    label: "SENSOR 4",
                    backgroundColor: 'rgb(79, 187, 122  ,0.2)',
                    borderColor: 'rgb(79, 187, 122  ,0.9)',
                    fill:true,
                    data: []
                }]
            },
            options: {
                scales: {
                    y: {
                        max:50,
                        min:0,
                        beginAtZero: false,
                        position: 'right'
                    }
                },
                plugins: {
                    zoom: {
                        zoom: {
                        wheel: {
                            enabled: true,
                        },
                        pinch: {
                            enabled: true
                        },
                        mode: 'y',
                        }
                    }
                },         
                responsive: false
            }
        });

        // const ctx5 = document.getElementById('myChart5').getContext('2d');
        // const myChart5 = new Chart(ctx5, {
        //     type: 'line',
        //     data: {
        //         labels: ['TIEMPO'],
        //         datasets: [{
        //             label: "VOLTAJE",
        //             backgroundColor: 'rgb(187, 79, 156 ,0.2)',
        //             borderColor: 'rgb(187, 79, 156 ,0.9)',
        //             fill:true,
        //             data: []
        //         }]
        //     },
        //     options: {
        //         scales: {
        //             y: {
        //                 beginAtZero: true
        //             }
        //         },
        //         responsive: false
        //     }
        // });

    </script>

</body>
</html>